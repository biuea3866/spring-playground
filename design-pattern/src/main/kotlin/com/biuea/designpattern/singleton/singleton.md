# 싱글톤 패턴

싱글톤 패턴이란 단 하나의 유일한 객체를 만들기 위한 패턴이다.  
메모리 절약을 위해 인스턴스가 필요할 때 똑같은 인스턴스를 다시 만들지 않고, 기존의 인스턴스를 재활용하는 기법이다.

대표적으로 데이터베이스 연결 모듈이 존재하며, 데이터베이스 커넥션 풀, 스레드 풀 등과 같은 곳에서 미리 인스턴스 객체를 만들어 놓고 재활용하는 모습을 볼 수 있다.   

# 싱글톤 패턴 구현 기법
## 1. Eager Initialization
한번 미리 만들너 두고 static하게 구성되어 멀티 쓰레드 환경에서 안전하다.
다만 프로그램 부팅 시 메모리에 적재되어 상시 유지되기 때문에 자원 낭비가 발생할 수 있다.

## 2. Lazy Initialization
객체 생성에 대한 관리를 내부적으로 처리하며, 메서드를 이용하여 싱글톤 인스턴스를 호출할 때 존재 유무에 따라 초기화하거나 반환하는 기법이다.  
static하게 메모리에 적재되지 않기 때문에 메모리 절약이 가능하다.    
하지만 스레드 A, B가 동시에 해당 인스턴스를 호출하려고 할 경우 인스턴스가 두 번 생성될 수 있기 때문에 멀티 쓰레드 환경에서 안전하지 않다.

## 3. Thread-Safe Lazy Initialization
syncronized 키워드를 이용하여 멀티 쓰레드 환경에서 안전하게 싱글톤 인스턴스에 접근하는 방법이다.  
하지만 여러 쓰레드가 접근하여 매번 객체를 가져온다면 overhead가 발생해 성능 하락이 발생한다.

## 4. Double-Checked Locking
매번 syncronized 키워드를 이용하여 객체를 가져오는 것이 아닌, 최초 초기화 시에만 적용하고 이미 만들어진 인스턴스에 접근하는 기법이다.  
volatile 키워드를 이용하여 IO 불일치 문제를 해결할 수 있다.

```
volatile란

java에서 멀티 쓰레드를 사용할 경우 성능을 위해 쓰레드는 변수를 메인 메모리 (ram)이 아닌 캐시 메모리에서 데이터를 가져오게 된다.
각 쓰레드마다 할당되어있는 캐시 메모리의 변수 값이 일치하지 않는 문제가 있을 수 있기 때문에 메인 메모리로부터 데이터를 가져오도록 하는 키워드이다. 
```

## 5. Bill Pugh Solution
클래스 안에 내부 클래스(holder)를 두어 JVM의 클래스 로더 메커니즘과 클래스가 로드되는 시점을 이용하는 기법이다.  
static 메서드에서는 static 멤버만을 호출할 수 있기 때문에 내부 클래스를 static하게 선언하여 싱글톤 인스턴스를 생성한다.

## 6. Enum
enum은 멤버를 만들 때 private으로 만들고 한번만 초기화되기 때문에 thread safe하다.  
내부에서 상수, 변수, 메서드 등을 만들 수 있기 때문에 싱글톤 패턴으로 응용이 가능하다.  
하지만 상속이라던지, 일반 클래스로 마이그레이션이 필요할 때 변경이 어렵다.

# 싱글톤 패턴의 문제점
싱글톤 패턴은 고정된 메모리 영역에서 하나의 인스턴스만을 공유하고 사용하기 때문에 메모리 낭비를 줄일 수 있지만, 다음과 같은 문제점이 존재한다.

## 1. 모듈 간 의존성
싱글톤은 객체를 미리 생성하고 정적 메소드를 통해 사용하기 때문에 클래스 간 강한 의존성과 높은 결합이 생긴다.  
이 싱글톤 객체를 참조하는 곳이 여러 곳이라면 싱글톤 객체의 변경에 의해 여러 모듈에 대한 변경이 생길 수 있다.

## 2. solid 위반
싱글톤 객체 하나만으로 여러 책임을 지니는 경우가 많아 단일 책임 원칙에 대한 위반, 클래스 간의 결합도가 높아져 개방 폐쇄 원칙에 위반할 수 있다.  
그리고 구체 클래스에 대해 의존하게 되어 의존 역전 원칙을 위반한다.